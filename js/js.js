var propuestas = [
    {
        "titulo": "Mejora de la acera de Botánico Cavanilles \n" +
        "(puerta de Viveros a Blasco Ibañez)" ,
        "text": "<p>Es proposa millorar l’eficiència energètica de l’enllumenat en diferents barris de la ciutat que permeta un major estalvi econòmic, la renovació del mobiliari així com una millora en la instal·lació, amb una llum més agradable i la reducció d’emissions</p>",
        "id": 1,
        "fecha": "11/11/2017",
        "precio": 200000,
        "tipo": "Ciudadania",
        "lugar": "Toda la ciudad",
        "votado": false
    },
    {
        "titulo": "Mejora de la acera de Botánico Cavanilles \n" +
        "(puerta de Viveros a Blasco Ibañez)" ,
        "text": "<p>El objectiu del projecte és la millora de la connectivitat dels pobles de València mitjançant:</p>\n" +
        "\n" +
        "<ul>\n" +
        "\t<li>Instal·lació de Wifi públic a l’interior dels 21 edificis municipals dels 15 pobles de València</li>\n" +
        "\t<li>Instal·lació de Wifi públic exterior </li>\n" +
        "</ul>",
        "id": 2,
        "fecha": "16/11/2017",
        "precio": 500785,
        "tipo": "Ciudadania",
        "lugar": "Toda la ciudad",
        "votado": false
    },
    {
        "titulo": "Propuesta 6trtjtj j 776k76 k67k aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa" ,
        "text": "Propuesta numero 3Propuesta numero 3Propuesta numero 3Propuesta numero 3Propuesta numero 3Propuesta numero 3Propuesta numero 3Propuesta numero 3Propuesta numero 3Propuesta numero 3Propuesta numero 3Propuesta numero 3Propuesta numero 3Propuesta numero 3Propuesta numero 3Propuesta numero 3Propuesta numero 3Propuesta numero 3Propuesta numero 3Propuesta numero 3Propuesta numero 3Propuesta numero 3Propuesta numero 3Propuesta numero 3Propuesta numero 3Propuesta numero 3Propuesta numero 3Propuesta numero 3Propuesta numero 3Propuesta numero 3Propuesta numero 3Propuesta numero 3Propuesta numero 3Propuesta numero 3Propuesta numero 3Propuesta numero 3Propuesta numero 3Propuesta numero 3Propuesta numero 3Propuesta numero 3Propuesta numero 3Propuesta numero 3Propuesta numero 3Propuesta numero 3Propuesta numero 3Propuesta numero 3Propuesta numero 3",
        "id": 3,
        "fecha": "32/13/2017",
        "precio": 2008737,
        "tipo": "Ciudadania",
        "lugar": "Toda la ciudad",
        "votado": false
    },
    {
        "titulo": "Propuesta La siguiente es un 4 " ,
        "text": "Propuesta numero 3Propuesta numero 3Propuesta numero 3Propuesta numero 3Propuesta numero 3Propuesta numero 3Propuesta numero 3Propuesta numero 3Propuesta numero 3Propuesta numero 3Propuesta numero 3Propuesta numero 3Propuesta numero 3Propuesta numero 3Propuesta numero 3Propuesta numero 3Propuesta numero 3Propuesta numero 3Propuesta numero 3Propuesta numero 3Propuesta numero 3Propuesta numero 3Propuesta numero 3Propuesta numero 3Propuesta numero 3Propuesta numero 3Propuesta numero 3Propuesta numero 3Propuesta numero 3Propuesta numero 3Propuesta numero 3Propuesta numero 3Propuesta numero 3Propuesta numero 3Propuesta numero 3Propuesta numero 3Propuesta numero 3Propuesta numero 3Propuesta numero 3Propuesta numero 3Propuesta numero 3Propuesta numero 3Propuesta numero 3Propuesta numero 3Propuesta numero 3Propuesta numero 3Propuesta numero 3",
        "id": 4,
        "fecha": "32/13/2017",
        "precio": 2033830,
        "tipo": "Ciudadania",
        "lugar": "Toda la ciudad",
        "votado": false
    },{
        "titulo": "Propuesta La siguiente es un Spoiler de Mr Robot " ,
        "text": "Propuesta numero 3Propuesta numero 3Propuesta numero 3Propuesta numero 3Propuesta numero 3Propuesta numero 3Propuesta numero 3Propuesta numero 3Propuesta numero 3Propuesta numero 3Propuesta numero 3Propuesta numero 3Propuesta numero 3Propuesta numero 3Propuesta numero 3Propuesta numero 3Propuesta numero 3Propuesta numero 3Propuesta numero 3Propuesta numero 3Propuesta numero 3Propuesta numero 3Propuesta numero 3Propuesta numero 3Propuesta numero 3Propuesta numero 3Propuesta numero 3Propuesta numero 3Propuesta numero 3Propuesta numero 3Propuesta numero 3Propuesta numero 3Propuesta numero 3Propuesta numero 3Propuesta numero 3Propuesta numero 3Propuesta numero 3Propuesta numero 3Propuesta numero 3Propuesta numero 3Propuesta numero 3Propuesta numero 3Propuesta numero 3Propuesta numero 3Propuesta numero 3Propuesta numero 3Propuesta numero 3",
        "id": 5,
        "fecha": "32/13/2017",
        "precio": 203450,
        "tipo": "Ciudadania",
        "lugar": "Toda la ciudad",
        "votado": false
    }
    ,{
        "titulo": "Propuesta La siguiente es un Spoiler de Mr Robot " ,
        "text": "Propuesta numero 3Propuesta numero 3Propuesta numero 3Propuesta numero 3Propuesta numero 3Propuesta numero 3Propuesta numero 3Propuesta numero 3Propuesta numero 3Propuesta numero 3Propuesta numero 3Propuesta numero 3Propuesta numero 3Propuesta numero 3Propuesta numero 3Propuesta numero 3Propuesta numero 3Propuesta numero 3Propuesta numero 3Propuesta numero 3Propuesta numero 3Propuesta numero 3Propuesta numero 3Propuesta numero 3Propuesta numero 3Propuesta numero 3Propuesta numero 3Propuesta numero 3Propuesta numero 3Propuesta numero 3Propuesta numero 3Propuesta numero 3Propuesta numero 3Propuesta numero 3Propuesta numero 3Propuesta numero 3Propuesta numero 3Propuesta numero 3Propuesta numero 3Propuesta numero 3Propuesta numero 3Propuesta numero 3Propuesta numero 3Propuesta numero 3Propuesta numero 3Propuesta numero 3Propuesta numero 3",
        "id": 6,
        "fecha": "32/13/2017",
        "precio": 206880,
        "tipo": "Ciudadania",
        "votado": false,
        "lugar": "Toda la ciudad",
    }
    ,{
        "titulo": "Propuesta La siguiente es un Spoiler de Mr Robot " ,
        "text": "Propuesta numero 3Propuesta numero 3Propuesta numero 3Propuesta numero 3Propuesta numero 3Propuesta numero 3Propuesta numero 3Propuesta numero 3Propuesta numero 3Propuesta numero 3Propuesta numero 3Propuesta numero 3Propuesta numero 3Propuesta numero 3Propuesta numero 3Propuesta numero 3Propuesta numero 3Propuesta numero 3Propuesta numero 3Propuesta numero 3Propuesta numero 3Propuesta numero 3Propuesta numero 3Propuesta numero 3Propuesta numero 3Propuesta numero 3Propuesta numero 3Propuesta numero 3Propuesta numero 3Propuesta numero 3Propuesta numero 3Propuesta numero 3Propuesta numero 3Propuesta numero 3Propuesta numero 3Propuesta numero 3Propuesta numero 3Propuesta numero 3Propuesta numero 3Propuesta numero 3Propuesta numero 3Propuesta numero 3Propuesta numero 3Propuesta numero 3Propuesta numero 3Propuesta numero 3Propuesta numero 3",
        "id": 7,
        "fecha": "32/13/2017",
        "precio": 2028860,
        "tipo": "Ciudadania",
        "lugar": "Toda la ciudad",
        "votado": false
    }
    ,{
        "titulo": "Propuesta La siguiente es un Spoiler de Mr Robot " ,
        "text": "Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborumLorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborumLorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborumLorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborumLorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum",
        "id": 8,
        "fecha": "32/13/2017",
        "precio": 20280,
        "tipo": "Ciudadania",
        "lugar": "Toda la ciudad",
        "votado": false
    }

]


var propuestaIndex = 0;
var id = null
var presupuestoRestante = 3000000


function plusPropuestas(n) {
    propuestaIndex += n;
    showPropuestas();
}

function print(x){
    console.log(x)
}

function show_presupuesto(){
    span_pres = $('#presupuesto')
    span_pres.html(presupuestoRestante.toLocaleString() + " €")
}

function add_carrito(){
    propuesta = propuestas[propuestaIndex];
    // print(propuesta)
    if (presupuestoRestante - propuesta["precio"] < 0){
        alert("No tiene suficiente presupuesto")
        return
    }else{
        presupuestoRestante = presupuestoRestante - propuesta["precio"];

        propuestas[propuestaIndex].votado = true
        // print("propuestas: ")
        // print(propuestas)

        reload()

    }

}

function reload_lista(){
    // print("reload_lista")
    lista = $('.lista ul')
    lista.empty();
    for(p in propuestas) {
        if (propuestas[p].votado) {
            propuesta = propuestas[p]
            lista.append(
                '      ' +
                '<li>\n' +
                '      <div class="item">' +
                // '<h4>Presupuesto ' + propuesta.id + '</h4>\n' +
                '      <p class="listaCarrito">' + propuesta.titulo.substr(0, 100) + '</p>' +
                '      <h5>' + propuesta.precio.toLocaleString()  + ' €</h5> ' +
                '</div>' +
                '<div class=\"eliminar\" id =\" ' + propuesta.id + '\" onclick=\"eliminar(' + propuesta.id + ')\"></div></li>'
            )
        }

    }

}

function eliminar(ident){
    // print("eliminar")
    propuesta = null
    num = null
    for (p in propuestas){
        if (propuestas[p].id == ident){
            propuesta = propuestas[p]
            num = p
            break;
        }
    }
    // propuestas.push(propuesta)
    presupuestoRestante = presupuestoRestante + propuesta.precio
    propuestas[num].votado = false
    reload()
}

function showPropuestas() {

    // var x = document.getElementsByClassName("mySlides");
    x = $('#propuesta')

    if (propuestaIndex >= propuestas.length) {
        propuestaIndex = 0
    }
    else if (propuestaIndex < 0) {
        propuestaIndex = propuestas.length - 1
    }
    // print(propuestaIndex)
    // print(propuestas[propuestaIndex])
    descripcion = propuestas[propuestaIndex]["text"]
    titulo = propuestas[propuestaIndex]["titulo"]
    fecha = propuestas[propuestaIndex]["fecha"]
    precio = propuestas[propuestaIndex]["precio"]
    tipo = propuestas[propuestaIndex]["tipo"]
    id = propuestas[propuestaIndex]["id"]
    x.html(descripcion);
    $('.tipoPropuesta').html(tipo);
    $('.fechaPropuesta').html(fecha);
    $('.precioPropuesta').html(precio.toLocaleString() +" €");
    $('.tituloPropuesta').html(titulo);
    $('#codigoP').html("VLC-2017-"+id);
    if(propuestas[propuestaIndex].votado){
        // print("Votado")
        $('#botonVotar').html("Votado");
        $('#botonVotar').addClass("no-click")
    }else{
        // print("Votar")
        $('#botonVotar').html("Votar");
        $('#botonVotar').removeClass("no-click")
    }

}

/**
 * return numero de proyectos votados, inversion total
 */
function recuento(){
    n = 0
    total = 0
    for (p in propuestas){

        if (propuestas[p].votado){
            n++;
            total += propuestas[p].precio
        }
    }

    return [n, total]
}

function comprobarVotacion(){
    // When the user clicks the button, open the modal
    modal.style.display = "block";
    fondo.style.display = "block";
    [n, total] = recuento()
    $('.nProyectosVotados').html(n+" proyectos");
    $('.importeTotal').html(total.toLocaleString() +" €");

}

function reload(){
    // print("reload")
    show_presupuesto();
    showPropuestas();
    reload_lista();
}

$.fn.extend({
    disableSelection: function() {
        this.each(function() {
            this.onselectstart = function() {
                return false;
            };
            this.unselectable = "on";
            $(this).css('-moz-user-select', 'none');
            $(this).css('-webkit-user-select', 'none');
        });
        return this;
    }
});

function disable(){

    $('body').css('cursor', 'none');

    $('body').contextmenu(function(e){

        e.preventDefault();
        e.stopPropagation();
        return false;
    });

    $('body').dblclick(function(e){

        // alert('ALERTA DE INTRUSO!');
        return false;
    });
    $('body').on('touchmove', function() {

        return false;
    });

    $('body').on('swipe', function() {

        return false;
    });

    $('body').on('swipeup', function() {

        return false;
    });

    $('body').on('swiperight', function() {

        return false;
    });

    $('body').on('swipedown', function() {

        return false;
    });

    $('body').on('swipedown', function() {

        return false;
    });

     $('body').on('taphold  ', function() {

        return false;
    });



    $('body').disableSelection();

}

function init(){
    print("Init")
    propuestaIndex = 0
    // print(propuestas[0])
    reload();
    btn = document.getElementById("enviarVotacion");
    btn.onclick = function() {
        comprobarVotacion();
    }
    disable();
}

